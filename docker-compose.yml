version: "2.1"
services:
    app:
        build: ./
        links:
            - db
        depends_on:
            db:
                condition: service_healthy
        ports:
            - "5000:5000"
    db:
        env_file:
            - ./.env
        image: mysql:5.7
        ports:
            - "32000:3306"
        healthcheck:
            test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "${MYSQL_USER}", "-p${MYSQL_PASSWORD}"]
            timeout: 20s
            retries: 10
